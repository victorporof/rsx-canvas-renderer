{"version":3,"sources":["dom.js"],"names":["Renderer","constructor","view","document","createElement","style","position","ownerDocument","documentElement","addEventListener","onWheel","removeEventListener","_nodes","appendRect","bounds","size","display","color","left","top","width","height","red","r","green","g","blue","b","alpha","a","node","backgroundColor","appendChild","push","parented","appendBorder","colors","widths","styles","tw","rw","bw","lw","ts","rs","bs","ls","tr","tg","tb","ta","rr","rg","rb","ra","br","bg","bb","ba","lr","lg","lb","la","boxSizing","borderTop","borderRight","borderBottom","borderLeft","appendImage","measured_image","image","src","images","get","image_key","appendText","shaped_text","textRun","source_text","textContent","fontInstance","fontInstances","font_instance_key","fontFamily","fontKey","fontSize","textString","map","v","Owned","Static","join","trim","orphan","changeBounds","index","X","Y","W","H","undefined","changeText","T"],"mappings":"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","file":"dom.js","sourcesContent":["/*\nCopyright 2016 Mozilla\nLicensed under the Apache License, Version 2.0 (the \"License\"); you may not use\nthis file except in compliance with the License. You may obtain a copy of the\nLicense at http://www.apache.org/licenses/LICENSE-2.0\nUnless required by applicable law or agreed to in writing, software distributed\nunder the License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR\nCONDITIONS OF ANY KIND, either express or implied. See the License for the\nspecific language governing permissions and limitations under the License.\n*/\n\n/* eslint no-cond-assign: \"off\" */\n\nimport Base from './renderer';\n\nclass Renderer extends Base {\n  constructor() {\n    const view = document.createElement('div');\n    view.style.position = 'fixed';\n\n    view.ownerDocument.documentElement.addEventListener('wheel', function onWheel() {\n      view.ownerDocument.documentElement.removeEventListener('wheen', onWheel);\n      view.style.position = 'absolute';\n    });\n\n    super(view);\n    this._nodes = [];\n  }\n\n  appendRect({ bounds: { position, size }, display: { color } }) {\n    const { left, top } = position;\n    const { width, height } = size;\n    const {\n      red: r, green: g, blue: b, alpha: a,\n    } = color;\n\n    const node = this.view.ownerDocument.createElement('div');\n    node.style.left = `${left | 0}px`;\n    node.style.top = `${top | 0}px`;\n    node.style.width = `${width | 0}px`;\n    node.style.height = `${height | 0}px`;\n    if ((r || g || b) && a) {\n      node.style.backgroundColor = `rgba(${r}, ${g}, ${b}, ${a / 255})`;\n    }\n\n    this.view.appendChild(node);\n    this._nodes.push({ parented: node });\n  }\n\n  appendBorder({ bounds: { position, size }, display: { colors, widths, styles } }) {\n    const { left, top } = position;\n    const { width, height } = size;\n    const [tw, rw, bw, lw] = widths;\n    const [ts, rs, bs, ls] = styles;\n    const [{\n      red: tr, green: tg, blue: tb, alpha: ta,\n    }, {\n      red: rr, green: rg, blue: rb, alpha: ra,\n    }, {\n      red: br, green: bg, blue: bb, alpha: ba,\n    }, {\n      red: lr, green: lg, blue: lb, alpha: la,\n    }] = colors;\n\n    const node = this.view.ownerDocument.createElement('div');\n    node.style.boxSizing = 'border-box';\n    node.style.left = `${left | 0}px`;\n    node.style.top = `${top | 0}px`;\n    node.style.width = `${width | 0}px`;\n    node.style.height = `${height | 0}px`;\n    node.style.borderTop = `${tw}px ${ts} rgba(${tr}, ${tg}, ${tb}, ${ta / 255})`;\n    node.style.borderRight = `${rw}px ${rs} rgba(${rr}, ${rg}, ${rb}, ${ra / 255})`;\n    node.style.borderBottom = `${bw}px ${bs} rgba(${br}, ${bg}, ${bb}, ${ba / 255})`;\n    node.style.borderLeft = `${lw}px ${ls} rgba(${lr}, ${lg}, ${lb}, ${la / 255})`;\n\n    this.view.appendChild(node);\n    this._nodes.push({ parented: node });\n  }\n\n  appendImage({ bounds: { position, size }, display: { measured_image: image } }) {\n    const { left, top } = position;\n    const { width, height } = size;\n\n    const node = this.view.ownerDocument.createElement('img');\n    node.style.left = `${left | 0}px`;\n    node.style.top = `${top | 0}px`;\n    node.style.width = `${width | 0}px`;\n    node.style.height = `${height | 0}px`;\n    node.src = this.images.get(image.image_key);\n\n    this.view.appendChild(node);\n    this._nodes.push({ parented: node });\n  }\n\n  appendText({ bounds: { position, size }, display: { color, shaped_text: textRun, source_text: textContent } }) {\n    const { left, top } = position;\n    const { width, height } = size;\n    const {\n      red: r, green: g, blue: b, alpha: a,\n    } = color;\n\n    const fontInstance = this.fontInstances.get(textRun[0].font_instance_key);\n    const node = this.view.ownerDocument.createElement('pre');\n    node.style.left = `${left | 0}px`;\n    node.style.top = `${top | 0}px`;\n    node.style.width = `${width | 0}px`;\n    node.style.height = `${height | 0}px`;\n    node.style.fontFamily = `\"${fontInstance.fontKey}\"`;\n    node.style.fontSize = `${fontInstance.fontSize}px`;\n    if ((r || g || b) && a) {\n      node.style.color = `rgba(${r}, ${g}, ${b}, ${a / 255})`;\n    }\n\n    // FIXME: print shaped text instead of source text.\n    const textString = textContent.map(v => v.Owned || v.Static).join('');\n    node.textContent = textString;\n\n    if (textString.trim()) {\n      this.view.appendChild(node);\n      this._nodes.push({ parented: node });\n    } else {\n      this._nodes.push({ orphan: node });\n    }\n  }\n\n  changeBounds(index, {\n    X: left, Y: top, W: width, H: height,\n  }) {\n    const node = this._nodes[index].parented;\n\n    if (left !== undefined) {\n      node.style.left = `${left | 0}px`;\n    } else if (top !== undefined) {\n      node.style.top = `${top | 0}px`;\n    } else if (width !== undefined) {\n      node.style.width = `${width | 0}px`;\n    } else if (height !== undefined) {\n      node.style.height = `${height | 0}px`;\n    }\n  }\n\n  changeText(index, { T: textContent }) {\n    const node = this._nodes[index];\n\n    if (node.orphan) {\n      node.orphan.textContent = textContent;\n      this.view.appendChild(node.orphan);\n      this._nodes[index] = { parented: node.orphan };\n    } else {\n      node.parented.textContent = textContent;\n    }\n  }\n}\n\nexport default Renderer;\n"]}
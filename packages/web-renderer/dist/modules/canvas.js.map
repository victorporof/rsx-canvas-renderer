{"version":3,"sources":["canvas.js"],"names":["PIXI","Renderer","constructor","deviceWidth","window","innerWidth","deviceHeight","innerHeight","devicePixelRatio","backgroundColor","preventWebGL","view","document","createElement","style","width","height","app","Application","resolution","rgbNumber","forceCanvas","appendRect","bounds","position","size","display","color","left","top","red","green","blue","alpha","node","Graphics","beginFill","rgb","drawRect","endFill","stage","addChild","appendBorder","colors","widths","tw","rw","bw","lw","tr","tg","tb","ta","rr","rg","rb","ra","br","bg","bb","ba","lr","lg","lb","la","lineStyle","moveTo","lineTo","appendImage","measured_image","image","Sprite","fromImage","images","get","image_key","x","y","appendText","shaped_text","textRun","source_text","textContent","fontInstance","fontInstances","font_instance_key","TextStyle","fontFamily","fontKey","fontSize","fill","Text","Static","Owned"],"mappings":"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","file":"canvas.js","sourcesContent":["/*\nCopyright 2016 Mozilla\nLicensed under the Apache License, Version 2.0 (the \"License\"); you may not use\nthis file except in compliance with the License. You may obtain a copy of the\nLicense at http://www.apache.org/licenses/LICENSE-2.0\nUnless required by applicable law or agreed to in writing, software distributed\nunder the License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR\nCONDITIONS OF ANY KIND, either express or implied. See the License for the\nspecific language governing permissions and limitations under the License.\n*/\n\n/* eslint no-cond-assign: \"off\" */\n\nimport * as PIXI from 'pixi.js';\nimport Color from 'color';\n\nimport Base from './renderer';\n\nclass Renderer extends Base {\n  constructor({\n    deviceWidth = window.innerWidth,\n    deviceHeight = window.innerHeight,\n    devicePixelRatio = window.devicePixelRatio,\n    backgroundColor = '#fff',\n    preventWebGL = false,\n  } = {}) {\n    const view = document.createElement('canvas');\n    view.style.width = '100%';\n    view.style.height = '100%';\n    super(view);\n\n    this.app = new PIXI.Application(deviceWidth, deviceHeight, {\n      view: this.view,\n      resolution: devicePixelRatio,\n      backgroundColor: Color(backgroundColor).rgbNumber(),\n      forceCanvas: preventWebGL,\n    });\n  }\n\n  appendRect({ bounds: { position, size }, display: { color } }) {\n    const { left, top } = position;\n    const { width, height } = size;\n    const {\n      red, green, blue, alpha,\n    } = color;\n\n    const node = new PIXI.Graphics();\n    node.beginFill(Color.rgb(red, green, blue).rgbNumber(), alpha / 255);\n    node.drawRect(left, top, width, height);\n    node.endFill();\n\n    this.app.stage.addChild(node);\n  }\n\n  appendBorder({ bounds: { position, size }, display: { colors, widths } }) {\n    const { left, top } = position;\n    const { width, height } = size;\n    const [tw, rw, bw, lw] = widths;\n    const [{\n      red: tr, green: tg, blue: tb, alpha: ta,\n    }, {\n      red: rr, green: rg, blue: rb, alpha: ra,\n    }, {\n      red: br, green: bg, blue: bb, alpha: ba,\n    }, {\n      red: lr, green: lg, blue: lb, alpha: la,\n    }] = colors;\n\n    {\n      const node = new PIXI.Graphics();\n      node.lineStyle(tw, Color.rgb(tr, tg, tb).rgbNumber(), ta / 255);\n      node.moveTo(left, top);\n      node.lineTo(left + width, top);\n      this.app.stage.addChild(node);\n    }\n    {\n      const node = new PIXI.Graphics();\n      node.lineStyle(rw, Color.rgb(rr, rg, rb).rgbNumber(), ra / 255);\n      node.moveTo(left + width, top);\n      node.lineTo(left + width, top + height);\n      this.app.stage.addChild(node);\n    }\n    {\n      const node = new PIXI.Graphics();\n      node.lineStyle(bw, Color.rgb(br, bg, bb).rgbNumber(), ba / 255);\n      node.moveTo(left, top + height);\n      node.lineTo(left + width, top + height);\n      this.app.stage.addChild(node);\n    }\n    {\n      const node = new PIXI.Graphics();\n      node.lineStyle(lw, Color.rgb(lr, lg, lb).rgbNumber(), la / 255);\n      node.moveTo(left, top);\n      node.lineTo(left, top + height);\n      this.app.stage.addChild(node);\n    }\n  }\n\n  appendImage({ bounds: { position, size }, display: { measured_image: image } }) {\n    const { left, top } = position;\n    const { width, height } = size;\n\n    const node = PIXI.Sprite.fromImage(this.images.get(image.image_key));\n    node.x = left;\n    node.y = top;\n    node.width = width;\n    node.height = height;\n\n    this.app.stage.addChild(node);\n  }\n\n  appendText({ bounds: { position }, display: { color, shaped_text: textRun, source_text: textContent } }) {\n    const { left, top } = position;\n    const {\n      red, green, blue, alpha,\n    } = color;\n\n    const fontInstance = this.fontInstances.get(textRun.font_instance_key);\n\n    const style = new PIXI.TextStyle({\n      fontFamily: `\"${fontInstance.fontKey}\"`,\n      fontSize: fontInstance.fontSize,\n      fill: [Color.rgb(red, green, blue).alpha(alpha / 255).rgbNumber()],\n    });\n\n    // FIXME: print shaped text instead of source text.\n    const node = new PIXI.Text(textContent.Static || textContent.Owned, style);\n    node.x = left;\n    node.y = top;\n\n    this.app.stage.addChild(node);\n  }\n}\n\nexport default Renderer;\n"]}